import{j as o}from"./react-jsx-CMSr4IcU.js";import{r as a}from"./react-core-D2g-_gCs.js";import{d as l}from"./styled-C4Pyk3iD.js";import{D as I,a as q,b as x,c as V,d as $,e as k,f as M,g as J}from"./components-CTwu4HYZ.js";const K=l.div.withConfig({componentId:"sc-9hb0kd-0"})(["display:flex;flex-direction:column;height:100%;"]),Z=l.div.withConfig({componentId:"sc-9hb0kd-1"})(["align-items:center;display:flex;width:100%;flex-direction:column;align-items:flex-start;@media (min-width:576px){flex-direction:row;justify-content:space-between;align-items:center;}"]),Q=l.div.withConfig({componentId:"sc-9hb0kd-2"})(["align-items:start;display:flex;column-gap:",";@media (min-width:576px){column-gap:",";align-items:center;}"],({theme:e})=>e.spacings["element-gap-sm"],({theme:e})=>e.spacings["element-gap-sm"]),X=l.div.withConfig({componentId:"sc-9hb0kd-3"})(["column-gap:",";display:none;@media (min-width:576px){display:flex;}"],({theme:e})=>e.spacings["element-gap-sm"]),Y=l.div.withConfig({componentId:"sc-9hb0kd-4"})(["align-items:center;display:flex;flex:1;justify-content:center;min-height:0;"]),U=l.div.withConfig({componentId:"sc-9hb0kd-5"})(["align-items:center;aspect-ratio:",";display:flex;height:auto;justify-content:center;margin-top:",";max-height:100%;max-width:80%;position:relative;width:80%;flex:1;"],({$width:e,$height:n})=>`${e} / ${n}`,({theme:e})=>e.spacings["section-gap"]),W=l.div.withConfig({componentId:"sc-9hb0kd-6"})(["height:100%;inset:0;position:absolute;width:100%;"]),ee=l.div.withConfig({componentId:"sc-9hb0kd-7"})(["align-items:center;display:flex;justify-content:space-between;margin-top:auto;padding-top:",";"],({theme:e})=>e.spacings["section-gap"]),te=l.div.withConfig({componentId:"sc-9hb0kd-8"})(["align-items:center;color:",";column-gap:",";display:flex;"],({theme:e})=>e.colors["emphasis-medium-fg"],({theme:e})=>e.spacings["element-gap-lg"]),ne=l.span.withConfig({componentId:"sc-9hb0kd-9"})(["align-items:center;column-gap:",";display:inline-flex;"],({theme:e})=>e.spacings["element-gap-xs"]),se=l(I).withConfig({componentId:"sc-9hb0kd-10"})(["display:flex;@media (min-width:576px){display:none;}"]),P=a.memo(({onDownload:e})=>o.jsxs(ee,{children:[o.jsx(te,{children:o.jsxs(ne,{children:[o.jsx(q,{name:"check-circle",size:16})," Free to use"]})}),o.jsx(se,{variant:"highlight",onClick:e,children:"Download"})]}));P.displayName="PhotoModalFooter";const O=a.memo(({author:e,onDownload:n})=>o.jsx(x.Header,{children:o.jsxs(Z,{children:[o.jsxs(Q,{children:[o.jsx(V,{name:e,size:"medium"}),o.jsx($,{as:"h2",size:"heading",children:e})]}),o.jsx(X,{children:o.jsx(I,{variant:"highlight",onClick:n,children:"Download"})})]})}));O.displayName="PhotoModalHeader";const oe=()=>{const[e,n]=a.useState(!1),t=a.useCallback(()=>{n(!0)},[]);return{isLoaded:e,handleOnLoad:t}},L=a.memo(({photo:e})=>{const{isLoaded:n,handleOnLoad:t}=oe();return o.jsx(Y,{children:o.jsxs(U,{$width:e.width,$height:e.height,children:[o.jsx(W,{children:o.jsx(k,{state:n?"inactive":"loading"})}),o.jsx(M,{alt:e.author,isLoaded:n,onLoad:t,src:e.download_url,style:{width:"100%",height:"100%",objectFit:"contain"}})]})})});L.displayName="PhotoModalImage";const R=a.memo(({photo:e,onClose:n,onDownload:t,state:s})=>o.jsx(x,{state:s,onClose:n,children:o.jsx(x.Content,{ariaLabel:`Preview ${e.author}`,children:o.jsxs(K,{children:[o.jsx(O,{author:e.author,onDownload:t}),o.jsx(L,{photo:e}),o.jsx(P,{onDownload:t})]})})}));R.displayName="PhotoModal";const ie={200:200,300:300,400:400,500:500,600:600};function D(e){return ie[e]??600}function ae(e,n,t){const s=D(n),i=Math.round(s*e),r=t.match(/\/id\/(\d+)\//);return r?`https://picsum.photos/id/${r[1]}/${s}/${i}`:`${t}?w=${s}&h=${i}`}function re(e,n,t){const s=D(n),i=Math.round(s*t),r=e.match(/\/id\/(\d+)\//);if(r){const d=r[1],h=`https://picsum.photos/id/${d}/${s}/${i}`,p=`https://picsum.photos/id/${d}/${s*2}/${i*2}`;return`${h} 1x, ${p} 2x`}const c=`${e}?w=${s}&h=${i}`,g=`${e}?w=${s*2}&h=${i*2}`;return`${c} 1x, ${g} 2x`}async function ce(e,n){const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.blob(),i=URL.createObjectURL(s),r=document.createElement("a");r.href=i,r.download=`${n}.jpg`,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}const le="150% 0%";let y=null;const f=new Map,de=()=>{const[e,n]=a.useState(!1),t=a.useRef(null);return a.useEffect(()=>{const s=t.current;if(!s||e)return;const i=he(),r=()=>{n(!0),i.unobserve(s),f.delete(s)};return f.set(s,r),i.observe(s),()=>{i.unobserve(s),f.delete(s)}},[e]),{imgRef:t,isInView:e}},he=()=>(y||(y=new IntersectionObserver(e=>{e.forEach(n=>{const t=f.get(n.target);t&&n.isIntersecting&&t()})},{rootMargin:le,threshold:0})),y),E=(e,n)=>a.useCallback(async t=>{t.preventDefault(),t.stopPropagation();try{await ce(e,`infinipix-${n}`)}catch{window.open(e,"_blank","noopener")}},[e,n]),ge=l.div.withConfig({componentId:"sc-1y2vw3i-0"})(["border-radius:",";position:relative;height:","px;overflow:hidden;width:","px;img{transition:transform 0.25s ease;}&:hover img,&:focus-within img{transform:scale(1.02);}&:focus-visible img,button:focus-visible img{outline:2px solid ",";outline-style:solid;outline-offset:-10px;border-radius:",";}"],({theme:e})=>e.radius.lg,({height:e})=>e,({width:e})=>e,({theme:e})=>e.colors["emphasis-high-fg"],({theme:e})=>e.radius.xl),j=l.div.withConfig({componentId:"sc-1y2vw3i-1"})([""," align-items:center;bottom:0;display:flex;justify-content:space-between;left:0;margin-bottom:",";opacity:0;padding:",";position:absolute;right:0;visibility:hidden;transition:opacity 0.25s ease,margin-bottom 0.25s ease,visibility 0.25s ease;background:linear-gradient( to top,color-mix(in srgb,var(--overlay-color) 80%,transparent) 0%,color-mix(in srgb,var(--overlay-color) 60%,transparent) 25%,color-mix(in srgb,var(--overlay-color) 40%,transparent) 45%,transparent 80% );"],({theme:e})=>`
    --overlay-color: ${e.colors["overlay-bg"]};
  `,({theme:e})=>`-${e.spacings[8]}`,({theme:e})=>e.spacings[16]),ue=l.figure.withConfig({componentId:"sc-1y2vw3i-2"})(["aspect-ratio:",";border-radius:",";display:flex;overflow:hidden;position:relative;&:hover ",",&:focus-within ","{margin-bottom:0;opacity:1;visibility:visible;}"],({width:e,height:n})=>`${e} / ${n}`,({theme:e})=>e.radius.surface,j,j),pe=l(x.Trigger).withConfig({componentId:"sc-1y2vw3i-3"})(["all:unset;cursor:pointer;display:block;width:100%;overflow:hidden;"]),me=l(I).withConfig({componentId:"sc-1y2vw3i-4"})(["&&:focus-visible,&&:focus{outline-color:",";}"],({theme:e})=>e.colors["emphasis-high-fg"]),H=a.memo(({alt:e,author:n,columnWidth:t,downloadUrl:s,height:i,isLoaded:r,onLoad:c,onOpen:g,priority:d="lazy",width:h})=>{const p=E(s,n),m=a.useCallback(g,[g]),u=a.useMemo(()=>i/h,[i,h]),w=a.useMemo(()=>ae(u,t,s),[u,t,s]),b=a.useMemo(()=>re(s,t,u),[s,t,u]),v=a.useMemo(()=>t*u,[t,u]);return o.jsxs(ue,{width:h,height:i,children:[o.jsx(pe,{type:"button",onClick:m,"aria-label":`Open preview: ${e}`,children:o.jsx(M,{alt:n,borderRadius:12,height:v,isLoaded:r,loading:d,onLoad:c,sizes:`${t}px`,src:w,srcSet:b,width:t})}),o.jsxs(j,{children:[o.jsx($,{color:"emphasis-high-fg",size:"md",weight:"bold",children:n}),o.jsx(me,{variant:"highlight",onClick:p,children:"Download"})]})]})});H.displayName="PhotoCardContent";const z=a.memo(({author:e,columnWidth:n,downloadUrl:t,height:s,id:i,onLoad:r,priority:c="lazy",src:g,width:d,...h})=>{const[p,m]=a.useState(!1),[u,w]=a.useState(!1),{imgRef:b,isInView:v}=de(),N=E(t,e),S=a.useMemo(()=>s/d,[s,d]),_=a.useMemo(()=>n*S,[n,S]),A=a.useMemo(()=>({author:e,id:i,width:d,height:s,download_url:t,url:g,...h}),[e,i,d,s,t,g,h]),F=a.useCallback(()=>{w(!0),r?.()},[r]),B=a.useCallback(()=>{m(!0)},[]),T=a.useCallback(()=>{m(!1)},[]),G=c==="eager"||v;return o.jsxs(o.Fragment,{children:[o.jsxs(ge,{height:_,ref:b,width:n,children:[o.jsx(k,{state:u?"inactive":"loading"}),G&&o.jsx(H,{author:e,columnWidth:n,downloadUrl:t,height:s,id:i,isLoaded:u,onLoad:F,onOpen:B,priority:c,src:g,width:d,...h})]}),p&&o.jsx(R,{onClose:T,onDownload:N,photo:A,state:p?"active":"inactive"})]})});z.displayName="PhotoCard";const fe="https://picsum.photos";async function xe({page:e=1,limit:n=30}){return fetch(`${fe}/v2/list?page=${e}&limit=${n}`)}const C=new Map;async function we({page:e=1,limit:n=30}){const t=JSON.stringify({page:e,limit:n});if(C.has(t))return C.get(t);const s=await xe({page:e,limit:n});if(!s.ok)throw new Error(`Photo list request failed: ${s.status}`);const i=await s.json(),r=s.headers.get("Link")||s.headers.get("link"),c={items:i,linkHeader:r};return C.set(t,c),c}function be(e){if(!e)return;const n=e.split(",").find(s=>s.includes('rel="next"'));if(!n)return;const t=n.match(/[?&]page=(\d+)/);return t?Number(t[1]):void 0}function ve(){const[e,n]=a.useState(()=>`${window.innerHeight}px 0px`);return a.useEffect(()=>{const t=()=>n(`${window.innerHeight}px 0px`);return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),e}function ye(e,n,t,s=.1){a.useEffect(()=>{const i=e.current;if(!i)return;const r=new IntersectionObserver(n,{root:null,rootMargin:t,threshold:s});return r.observe(i),()=>r.disconnect()},[e,n,t,s])}function Ce(e,n,t){const s=e[e.length-1],i=s?new Set(s.items.map(c=>c.id)):new Set,r=n.filter(c=>!i.has(c.id));return[...e,{items:r,next:t}]}function je(e=30){const n=a.useRef(1),t=a.useRef(null),s=ve(),[i,r]=a.useState([]),c=a.useCallback(async()=>{const d=n.current;if(!d)return;const{items:h,linkHeader:p}=await we({page:d,limit:e}),m=be(p);n.current=m??null,r(u=>Ce(u,h,m))},[e]);a.useEffect(()=>{c()},[c]);const g=a.useCallback(d=>{const h=d[0];h&&h.isIntersecting&&c()},[c]);return ye(t,g,s),{pages:i,sentinel:t}}const Ie=l.div.withConfig({componentId:"sc-1jdbwis-0"})(["--header-height:80px;max-width:var(--content-max-width);padding:0 var(--page-gutter) var(--section-gap);margin:var(--header-height) auto 0;"]),Se=()=>{const{pages:e,sentinel:n}=je(30),t=e.flatMap(i=>i.items),s=a.useCallback((i,r,c)=>{const g=c<12;return o.jsx(z,{...i,src:i.download_url,columnWidth:r,alt:i.author,downloadUrl:i.download_url,priority:g?"eager":"lazy"},c)},[]);return o.jsxs(Ie,{children:[o.jsx(J,{data:t,renderItem:s}),o.jsx("div",{role:"none",ref:n,style:{height:1}})]})};Se.displayName="HomePage";export{Se as H};
